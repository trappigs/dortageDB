@model IEnumerable<dortageDB.Entities.Proje>
@{
    ViewData["Title"] = "Projelerimiz";
    Layout = "_LayoutFullWidth";
}

<!-- Page Title -->
<div class="page-title-section">
    <div class="container">
        <h1 class="page-title">TOPRAKTAR PORTFÖYÜ</h1>
    </div>
</div>

<!-- Filtre Section -->
<section class="filtre-section">
    <div class="container">
        <div class="filtre-card" data-aos="fade-up">
            <form asp-action="Index" method="get" id="filtreForm">
                <div class="row g-3 align-items-end">
                    <div class="col-md-2">
                        <label for="yatirimTuru" class="filtre-label">
                            <svg class="filtre-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                <path d="M3 9l9-7 9 7v11a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2z"/>
                                <polyline points="9 22 9 12 15 12 15 22"/>
                            </svg>
                            Yatırım Türü
                        </label>
                        <select class="form-select filtre-select" id="yatirimTuru" name="yatirimTuru">
                            <option value="">Tümü</option>
                            <option value="Arsa" selected="@(ViewBag.YatirimTuru == "Arsa")">Arsa</option>
                            <option value="Konut" selected="@(ViewBag.YatirimTuru == "Konut")">Konut</option>
                        </select>
                    </div>

                    <div class="col-md-2">
                        <label for="sehir" class="filtre-label">
                            <svg class="filtre-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                <path d="M21 10c0 7-9 13-9 13s-9-6-9-13a9 9 0 0 1 18 0z"/>
                                <circle cx="12" cy="10" r="3"/>
                            </svg>
                            Şehir
                        </label>
                        <select class="form-select filtre-select" id="sehir" name="sehir">
                            <option value="">Tüm Şehirler</option>
                            @foreach (var sehir in ViewBag.Sehirler as List<string>)
                            {
                                <option value="@sehir" selected="@(ViewBag.SelectedSehir == sehir)">@sehir</option>
                            }
                        </select>
                    </div>

                    <div class="col-md-2">
                        <label for="minFiyat" class="filtre-label">
                            <svg class="filtre-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                <line x1="12" y1="1" x2="12" y2="23"/>
                                <path d="M17 5H9.5a3.5 3.5 0 0 0 0 7h5a3.5 3.5 0 0 1 0 7H6"/>
                            </svg>
                            Min Fiyat
                        </label>
                        <input type="number" class="form-control filtre-input" id="minFiyat" name="minFiyat"
                               value="@ViewBag.MinFiyat" placeholder="₺ Minimum">
                    </div>

                    <div class="col-md-2">
                        <label for="maxFiyat" class="filtre-label">
                            <svg class="filtre-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                <line x1="12" y1="1" x2="12" y2="23"/>
                                <path d="M17 5H9.5a3.5 3.5 0 0 0 0 7h5a3.5 3.5 0 0 1 0 7H6"/>
                            </svg>
                            Max Fiyat
                        </label>
                        <input type="number" class="form-control filtre-input" id="maxFiyat" name="maxFiyat"
                               value="@ViewBag.MaxFiyat" placeholder="₺ Maximum">
                    </div>

                    <div class="col-md-2">
                        <div class="form-check filtre-check">
                            <input class="form-check-input" type="checkbox" id="taksit" name="taksit" value="true"
                                   checked="@(ViewBag.Taksit == true)">
                            <label class="form-check-label" for="taksit">
                                <svg class="check-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                    <rect x="1" y="4" width="22" height="16" rx="2" ry="2"/>
                                    <line x1="1" y1="10" x2="23" y2="10"/>
                                </svg>
                                Taksit
                            </label>
                        </div>
                    </div>

                    <div class="col-md-2">
                        <div class="form-check filtre-check">
                            <input class="form-check-input" type="checkbox" id="takas" name="takas" value="true"
                                   checked="@(ViewBag.Takas == true)">
                            <label class="form-check-label" for="takas">
                                <svg class="check-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                    <polyline points="17 1 21 5 17 9"/>
                                    <path d="M3 11V9a4 4 0 0 1 4-4h14"/>
                                    <polyline points="7 23 3 19 7 15"/>
                                    <path d="M21 13v2a4 4 0 0 1-4 4H3"/>
                                </svg>
                                Takas
                            </label>
                        </div>
                    </div>

                    <div class="col-md-1">
                        <button type="submit" class="btn btn-filtre">
                            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                <circle cx="11" cy="11" r="8"/>
                                <path d="m21 21-4.35-4.35"/>
                            </svg>
                        </button>
                    </div>
                </div>
            </form>

            @if (!string.IsNullOrEmpty(ViewBag.SelectedSehir as string) || ViewBag.MinFiyat != null || ViewBag.MaxFiyat != null || ViewBag.Taksit == true || ViewBag.Takas == true || !string.IsNullOrEmpty(ViewBag.YatirimTuru as string))
            {
                <div class="active-filters">
                    <span class="filter-label">Aktif Filtreler:</span>
                    <a asp-action="Index" class="btn-clear-filters">
                        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                            <line x1="18" y1="6" x2="6" y2="18"/>
                            <line x1="6" y1="6" x2="18" y2="18"/>
                        </svg>
                        Filtreleri Temizle
                    </a>
                </div>
            }
        </div>
    </div>
</section>

<!-- Projeler Grid -->
<section class="projeler-grid-section">
    <div class="container">
        @if (!Model.Any())
        {
            <div class="empty-state" data-aos="fade-up">
                <svg class="empty-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                    <circle cx="12" cy="12" r="10"/>
                    <line x1="12" y1="8" x2="12" y2="12"/>
                    <line x1="12" y1="16" x2="12.01" y2="16"/>
                </svg>
                <h3>Kriterlere Uygun Proje Bulunamadı</h3>
                <p>Lütfen filtrelerinizi değiştirerek tekrar deneyin.</p>
                <a asp-action="Index" class="btn btn-primary">Tüm Projeleri Görüntüle</a>
            </div>
        }
        else
        {
            <div class="row g-4">
                @foreach (var proje in Model)
                {
                    var satisYuzdesi = proje.ToplamParsel > 0 ? (double)proje.SatilanParsel / proje.ToplamParsel * 100 : 0;
                    var kalanParsel = proje.ToplamParsel - proje.SatilanParsel;

                    <div class="col-lg-4 col-md-6" data-aos="fade-up" data-aos-delay="@((Model.ToList().IndexOf(proje) % 3) * 100)">
                        <div class="proje-card">
                            @if (!string.IsNullOrEmpty(proje.KapakGorseli))
                            {
                                <div class="proje-image" style="background-image: url('@proje.KapakGorseli')">
                                    @if (satisYuzdesi >= 75)
                                    {
                                        <span class="proje-badge badge-hot">Hızla Tükeniyor</span>
                                    }
                                    else if (proje.KayitTarihi > DateTime.Now.AddDays(-30))
                                    {
                                        <span class="proje-badge badge-new">Yeni</span>
                                    }
                                </div>
                            }
                            else
                            {
                                <div class="proje-image proje-placeholder">
                                    <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1">
                                        <rect x="3" y="3" width="18" height="18" rx="2" ry="2"/>
                                        <circle cx="8.5" cy="8.5" r="1.5"/>
                                        <polyline points="21 15 16 10 5 21"/>
                                    </svg>
                                </div>
                            }

                            <div class="proje-content">
                                <div class="proje-header">
                                    <h3 class="proje-title">@proje.ProjeAdi</h3>
                                    <div class="proje-location">
                                        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                            <path d="M21 10c0 7-9 13-9 13s-9-6-9-13a9 9 0 0 1 18 0z"/>
                                            <circle cx="12" cy="10" r="3"/>
                                        </svg>
                                        @proje.Konum
                                    </div>
                                </div>

                                <p class="proje-description">@proje.Aciklama</p>

                                <div class="proje-features">
                                    @if (proje.Imarlimi)
                                    {
                                        <div class="feature-badge">
                                            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                                <polyline points="20 6 9 17 4 12"/>
                                            </svg>
                                            İmarlı
                                        </div>
                                    }
                                    @if (proje.MustakilTapu)
                                    {
                                        <div class="feature-badge">
                                            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                                <polyline points="20 6 9 17 4 12"/>
                                            </svg>
                                            Müstakil Tapu
                                        </div>
                                    }
                                    @if (proje.TaksitImkani)
                                    {
                                        <div class="feature-badge">
                                            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                                <polyline points="20 6 9 17 4 12"/>
                                            </svg>
                                            Taksit
                                        </div>
                                    }
                                    @if (proje.TakasImkani)
                                    {
                                        <div class="feature-badge">
                                            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                                <polyline points="20 6 9 17 4 12"/>
                                            </svg>
                                            Takas
                                        </div>
                                    }
                                </div>

                                <div class="proje-progress">
                                    <div class="progress-header">
                                        <span class="progress-label">Satış Durumu</span>
                                        <span class="progress-percent">%@Math.Round(satisYuzdesi, 0)</span>
                                    </div>
                                    <div class="progress">
                                        <div class="progress-bar" style="width: @satisYuzdesi%"></div>
                                    </div>
                                    <div class="progress-info">
                                        <span>@proje.SatilanParsel / @proje.ToplamParsel Parsel</span>
                                        <span class="kalan">@kalanParsel Kalan</span>
                                    </div>
                                </div>

                                <div class="proje-footer">
                                    <div class="proje-price">
                                        @if (proje.MinFiyat == proje.MaxFiyat)
                                        {
                                            <span class="price">@proje.MinFiyat.ToString("N0") ₺</span>
                                        }
                                        else
                                        {
                                            <span class="price-range">
                                                <span class="price-from">@proje.MinFiyat.ToString("N0") ₺</span>
                                                <span class="price-separator">-</span>
                                                <span class="price-to">@proje.MaxFiyat.ToString("N0") ₺</span>
                                            </span>
                                        }
                                    </div>
                                    <a asp-action="Details" asp-route-id="@proje.ProjeID" class="btn btn-proje-detail">
                                        Detayları İncele
                                        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                            <line x1="5" y1="12" x2="19" y2="12"/>
                                            <polyline points="12 5 19 12 12 19"/>
                                        </svg>
                                    </a>
                                </div>
                            </div>
                        </div>
                    </div>
                }
            </div>
        }
    </div>
</section>

@section Scripts {
    <link href="https://unpkg.com/aos@2.3.1/dist/aos.css" rel="stylesheet">
    <script src="https://unpkg.com/aos@2.3.1/dist/aos.js"></script>
    <link rel="stylesheet" href="~/css/projeler.css" asp-append-version="true" />

    <script>
        AOS.init({
            duration: 600,
            easing: 'ease-in-out',
            once: true,
            offset: 50
        });

        // Auto-submit on filter change
        document.querySelectorAll('#filtreForm select, #filtreForm input[type="checkbox"]').forEach(element => {
            element.addEventListener('change', function() {
                document.getElementById('filtreForm').submit();
            });
        });
    </script>
}
