@* dortageDB/Views/Settings/Profile.cshtml *@
@model UserSettingsVM

@{
    ViewData["Title"] = "Profil Ayarları";
    Layout = "_LayoutVekarer";
}

<link rel="stylesheet" href="~/css/vekarer-main-panel.css" asp-append-version="true" />
<link rel="stylesheet" href="~/css/user-settings.css" asp-append-version="true" />


<style>
    .main-content{
        margin-left: 260px !important;
        margin-top: 40px !important;
    }
    @@media (max-width: 768px) {
        margin-left: 0px !important;
    }
</style>

<div class="container-fluid px-4">
            <div class="breadcrumb">
                <a asp-controller="Home" asp-action="Index">Ana Sayfa</a> >
                <a asp-controller="Dashboard" asp-action="Index">Dashboard</a> >
                Profil Ayarları
            </div>

    <h1>Hesap Ayarları</h1>
    <p class="subtitle">Profil bilgilerinizi ve hesap ayarlarınızı yönetin</p>

    @if (TempData["SuccessMessage"] != null)
    {
        <div class="toast success show">
            @TempData["SuccessMessage"]
        </div>
    }

    @if (TempData["ErrorMessage"] != null)
    {
        <div class="toast error show">
            @TempData["ErrorMessage"]
        </div>
    }

    <div class="layout">
        <!-- Sidebar -->
        <aside class="settings-sidebar">
            <!-- Profile Preview Card -->
            <div class="profile-preview">
                <div class="avatar-container">
                    <div class="initials">
                        @if (!string.IsNullOrEmpty(Model.Ad) && !string.IsNullOrEmpty(Model.Soyad))
                        {
                            @(Model.Ad.Substring(0, 1))
                            @(Model.Soyad.Substring(0, 1))
                        }
                        else
                        {
                            <span>?</span>
                        }
                    </div>
                    <button class="upload-button" type="button" title="Fotoğraf Yükle">
                        📷
                    </button>
                </div>
                <div class="settings-user-name">@Model.Ad @Model.Soyad</div>
                @if (User.IsInRole("vekarer"))
                {
                    <span class="user-role">Vekarer</span>
                }
                @if (User.IsInRole("admin"))
                {
                    <span class="user-role" style="background: rgba(239, 68, 68, 0.1); color: #dc2626;">Admin</span>
                }
                <div class="member-since">
                    Üyelik: @DateTime.Now.ToString("MMMM yyyy")
                </div>
            </div>

            <div class="profile-progress">
                <div class="progress-text">Profil Tamamlanma: 75%</div>
                <div class="progress-bar">
                    <div class="progress-fill" style="width: 75%"></div>
                </div>
            </div>

            <!-- Navigation Tabs -->
            <nav class="tabs" role="tablist">
                <ul>
                    <li class="active" data-tab="personal" role="tab">
                        <span>👤</span> Kişisel Bilgiler
                    </li>
                    <li data-tab="security" role="tab">
                        <span>🔒</span> Güvenlik
                    </li>
                </ul>
            </nav>
        </aside>

        <!-- Main Content -->
        <main class="content">

            <!-- Personal Information Tab -->
            <div class="tab-content active" id="personal-tab">
                <form asp-action="UpdateProfile" method="post" id="profileForm">
                    @Html.AntiForgeryToken()

                    <h2>Kişisel Bilgiler</h2>

                    <div class="form-grid">
                        <div class="form-group">
                            <label asp-for="Ad">Ad <span class="required">*</span></label>
                            <input asp-for="Ad" type="text" placeholder="Adınız" required />
                            <span asp-validation-for="Ad" class="text-danger"></span>
                        </div>

                        <div class="form-group">
                            <label asp-for="Soyad">Soyad <span class="required">*</span></label>
                            <input asp-for="Soyad" type="text" placeholder="Soyadınız" required />
                            <span asp-validation-for="Soyad" class="text-danger"></span>
                        </div>
                    </div>

                    <div class="form-group">
                        <label asp-for="Email">E-posta Adresi <span class="required">*</span></label>
                        <input asp-for="Email" type="email" placeholder="ornek@email.com" readonly style="background: #f3f4f6; cursor: not-allowed;" />
                        <div class="help-text">
                            ℹ️ E-posta adresiniz değiştirilemez. Değişiklik için destek ile iletişime geçin.
                        </div>
                        <span asp-validation-for="Email" class="text-danger"></span>
                    </div>

                    <div class="form-group">
                        <label asp-for="PhoneNumber">Telefon Numarası <span class="required">*</span></label>
                        <input asp-for="PhoneNumber" type="tel" placeholder="(5XX) XXX XX XX" id="phoneInput" required />
                        <span asp-validation-for="PhoneNumber" class="text-danger"></span>
                    </div>

                    <div class="form-grid">
                        <div class="form-group">
                            <label asp-for="Cinsiyet">Cinsiyet <span class="required">*</span></label>
                            <select asp-for="Cinsiyet" required>
                                <option value="">Seçiniz</option>
                                <option value="false">Kadın</option>
                                <option value="true">Erkek</option>
                            </select>
                            <span asp-validation-for="Cinsiyet" class="text-danger"></span>
                        </div>

                        <div class="form-group">
                            <label asp-for="Sehir">Şehir <span class="required">*</span></label>
                            <select asp-for="Sehir" required>
                                <option value="">Şehir seçin</option>
                                <option value="İstanbul">İstanbul</option>
                                <option value="Ankara">Ankara</option>
                                <option value="İzmir">İzmir</option>
                                <option value="Bursa">Bursa</option>
                                <option value="Antalya">Antalya</option>
                                <option value="Adana">Adana</option>
                                <option value="Konya">Konya</option>
                                <option value="Gaziantep">Gaziantep</option>
                                <option value="Kayseri">Kayseri</option>
                            </select>
                            <span asp-validation-for="Sehir" class="text-danger"></span>
                        </div>
                    </div>

                    <!-- Action Bar -->
                    <div class="action-bar">
                        <div>
                            <span class="save-indicator" id="saveIndicator"></span>
                        </div>
                        <div style="display: flex; gap: 12px;">
                            <button type="button" class="cancel-button" onclick="window.location.href='@Url.Action("Index", "Dashboard")'">
                                İptal
                            </button>
                            <button type="submit" class="save-button" id="saveProfileBtn">
                                Değişiklikleri Kaydet
                            </button>
                        </div>
                    </div>
                </form>
            </div>

            <!-- Security Tab -->
            <div class="tab-content" id="security-tab">
                <form asp-action="ChangePassword" method="post" id="securityForm">
                    @Html.AntiForgeryToken()

                    <h2>Güvenlik Ayarları</h2>

                    <div class="form-group">
                        <label asp-for="CurrentPassword">Mevcut Şifre <span class="required">*</span></label>
                        <div class="password-input">
                            <input asp-for="CurrentPassword" type="password" placeholder="Mevcut şifreniz" id="currentPasswordInput" />
                            <span class="show-hide" data-target="currentPasswordInput">👁️</span>
                        </div>
                        <span asp-validation-for="CurrentPassword" class="text-danger"></span>
                    </div>

                    <div class="form-group">
                        <label asp-for="NewPassword">Yeni Şifre <span class="required">*</span></label>
                        <div class="password-input">
                            <input asp-for="NewPassword" type="password" placeholder="Yeni şifreniz" id="newPasswordInput" />
                            <span class="show-hide" data-target="newPasswordInput">👁️</span>
                        </div>
                        <div class="strength-meter">
                            <div class="strength-bar" id="strengthBar"></div>
                        </div>
                        <ul class="requirements" id="passwordRequirements">
                            <li id="req-length">En az 6 karakter</li>
                            <li id="req-uppercase">En az 1 büyük harf</li>
                            <li id="req-number">En az 1 rakam</li>
                            <li id="req-special">En az 1 özel karakter</li>
                        </ul>
                        <span asp-validation-for="NewPassword" class="text-danger"></span>
                    </div>

                    <div class="form-group">
                        <label asp-for="ConfirmNewPassword">Yeni Şifre (Tekrar) <span class="required">*</span></label>
                        <div class="password-input">
                            <input asp-for="ConfirmNewPassword" type="password" placeholder="Yeni şifrenizi tekrar girin" id="confirmPasswordInput" />
                            <span class="show-hide" data-target="confirmPasswordInput">👁️</span>
                        </div>
                        <span asp-validation-for="ConfirmNewPassword" class="text-danger"></span>
                    </div>

                    <!-- Action Bar -->
                    <div class="action-bar">
                        <div>
                            <span class="help-text">
                                ℹ️ Şifrenizi değiştirdikten sonra yeniden giriş yapmanız gerekebilir.
                            </span>
                        </div>
                        <div style="display: flex; gap: 12px;">
                            <button type="button" class="cancel-button" onclick="document.getElementById('securityForm').reset();">
                                İptal
                            </button>
                            <button type="submit" class="save-button" id="savePasswordBtn">
                                Şifreyi Değiştir
                            </button>
                        </div>
                    </div>
                </form>
            </div>

        </main>
    </div>

    <!-- Toast Notification -->
    <div class="toast" id="toast"></div>

</div>

@section Scripts {
    <partial name="_ValidationScriptsPartial" />
    <script src="~/js/user-settings.js" asp-append-version="true"></script>
}